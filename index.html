<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›½å†…ã‚³ã‚¢ãƒ©åé‘‘</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2e7d32">
    <link rel="apple-touch-icon" href="koalaface.png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <style>
        /* â–¼ ãƒ‡ã‚¶ã‚¤ãƒ³ã®è¨­å®šï¼ˆãƒ¦ãƒ¼ã‚«ãƒªè‰²ã¨ã‚³ã‚¢ãƒ©è‰²ï¼‰ */
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            padding: 20px;
            padding-top: env(safe-area-inset-top); /* iPhoneå¯¾ç­– */
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #2e7d32;
            margin-bottom: 5px;
        }
        
        p.subtitle {
            color: #666;
            font-size: 0.9em;
            margin-top: 0;
        }

        /* æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ */
        .search-box {
            text-align: center;
            margin-bottom: 25px;
        }

        input[type="text"] {
            padding: 12px;
            width: 85%;
            max-width: 400px;
            border: 2px solid #ddd;
            border-radius: 25px; /* ä¸¸ã¿ã‚’ã¤ã‘ã‚‹ */
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }
        input[type="text"]:focus {
            border-color: #2e7d32;
        }
        
        /* ã‚³ã‚¢ãƒ©ãƒªã‚¹ãƒˆã®ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º */
        .koala-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        /* ã‚³ã‚¢ãƒ©ã‚«ãƒ¼ãƒ‰ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .koala-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-left: 5px solid #2e7d32; /* å·¦ã®ç·‘ãƒ©ã‚¤ãƒ³ */
            transition: transform 0.2s;
        }
        
        .koala-card:active {
            transform: scale(0.98); /* ã‚¿ãƒƒãƒ—ã—ãŸæ™‚ã®å‹•ã */
        }

        .koala-header {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
        }

        .koala-name {
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
            margin: 0;
        }

        /* â–¼ ãƒãƒƒã‚¸ï¼ˆæ€§åˆ¥ã‚„å¹´é½¢ï¼‰ */
        .badge {
            font-size: 0.75em;
            padding: 3px 8px;
            border-radius: 12px;
            color: white;
            font-weight: normal;
            display: inline-block;
            vertical-align: middle;
        }
        .male { background-color: #4A90E2; }   /* ã‚ªã‚¹ï¼šé’ */
        .female { background-color: #E24A8D; } /* ãƒ¡ã‚¹ï¼šãƒ”ãƒ³ã‚¯ */
        .other { background-color: #999; }     /* ä¸æ˜ï¼šã‚°ãƒ¬ãƒ¼ */
        .age { background-color: #2ecc71; color: #fff; } /* å¹´é½¢ï¼šç·‘ */

        .koala-zoo {
            display: inline-block;
            background-color: #e8f5e9;
            color: #2e7d32;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 12px;
        }

        /* è©³ç´°æƒ…å ±ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .detail-grid {
            display: grid;
            grid-template-columns: auto 1fr; /* ãƒ©ãƒ™ãƒ«ã¨ä¸­èº« */
            gap: 5px 10px;
            font-size: 0.95em;
            color: #444;
        }
        
        .label-icon {
            color: #888;
            width: 20px;
            text-align: center;
        }

        /* ãƒ¡ãƒ¢æ¬„ */
        .memo-text {
            margin-top: 12px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 6px;
            font-size: 0.9em;
            color: #555;
            line-height: 1.5;
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸ¨ å›½å†…ã‚³ã‚¢ãƒ©åé‘‘</h1>
    <p class="subtitle">Search & Database</p>
</header>

<div class="search-box">
    <input type="text" id="searchInput" placeholder="åå‰ã‚„å‹•ç‰©åœ’ã§æ¤œç´¢..." onkeyup="filterKoalas()">
</div>

<div id="koalaList" class="koala-list">
    <p style="text-align:center; color:#999;">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
</div>

<script>
    // â–¼â–¼â–¼ ã‚³ã‚¢ãƒ©ãƒ‡ãƒ¼ã‚¿ï¼ˆæœ€åˆã¯ç©ºã£ã½ï¼‰ â–¼â–¼â–¼
    let koalaData = [];

    // â–¼â–¼â–¼ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€å‡¦ç† â–¼â–¼â–¼
    function loadFromSpreadsheet() {
        // â˜…â˜…â˜…é‡è¦ï¼šã“ã“ã«ã‚³ãƒ”ãƒ¼ã—ãŸURLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼â˜…â˜…â˜…
        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQi6GZ0pWmE1A0MSJBoSyHYaKvAHkgFeBRvZPmMHqHLBh53VzAr5nyJ43qOVuTj4y2xus5nzzurKmUX/pub?gid=107153803&single=true&output=csv";

        Papa.parse(sheetUrl, {
            download: true,
            header: true,
            complete: function(results) {
                // ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿æˆåŠŸï¼
                koalaData = results.data;
                // ç©ºè¡Œã‚„åå‰ãŒãªã„è¡Œã‚’é™¤å¤–
                koalaData = koalaData.filter(item => item.name && item.name !== "");
                
                console.log("èª­ã¿è¾¼ã¿å®Œäº†:", koalaData);
                // ç”»é¢ã«è¡¨ç¤º
                renderKoalas(koalaData);
            },
            error: function(err) {
                console.log("èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", err);
                document.getElementById('koalaList').innerHTML = '<p>ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>';
            }
        });
    }

    // â–¼â–¼â–¼ ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ â–¼â–¼â–¼
    function renderKoalas(data) {
        const list = document.getElementById('koalaList');
        list.innerHTML = ''; // ä¸€åº¦ãƒªã‚»ãƒƒãƒˆ

        if (data.length === 0) {
            list.innerHTML = '<p style="text-align:center;">è©²å½“ã™ã‚‹ã‚³ã‚¢ãƒ©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>';
            return;
        }

        data.forEach(koala => {
            // æ€§åˆ¥åˆ¤å®šï¼ˆã‚ªã‚¹/ãƒ¡ã‚¹/ãã®ä»–ï¼‰
            let genderClass = 'other';
            if (koala.gender && koala.gender.includes('ã‚ªã‚¹')) genderClass = 'male';
            if (koala.gender && koala.gender.includes('ãƒ¡ã‚¹')) genderClass = 'female';

            // ãƒ¡ãƒ¢ãŒã‚ã‚‹æ™‚ã ã‘HTMLã‚’ä½œã‚‹
            const memoHtml = koala.memo ? `<div class="memo-text">${koala.memo}</div>` : '';

            // ã‚«ãƒ¼ãƒ‰ã®HTMLã‚’ä½œæˆ
            const html = `
                <div class="koala-card">
                    <div class="koala-header">
                        <div class="koala-name">${koala.name}</div>
                        <span class="badge ${genderClass}">${koala.gender || "ä¸æ˜"}</span>
                        <span class="badge age">${koala.age || "-"}</span>
                    </div>

                    <div class="koala-zoo">ğŸ“ ${koala.zoo}</div>

                    <div class="detail-grid">
                        <span class="label-icon">ğŸ‚</span>
                        <span>${koala.birthday}</span>

                        <span class="label-icon">ğŸ¨</span>
                        <span>çˆ¶ï¼š${koala.father || "-"}</span>

                        <span class="label-icon">ğŸ¨</span>
                        <span>æ¯ï¼š${koala.mother || "-"}</span>
                    </div>
                    
                    ${memoHtml}
                </div>
            `;
            list.innerHTML += html;
        });
    }

    // â–¼â–¼â–¼ æ¤œç´¢æ©Ÿèƒ½ â–¼â–¼â–¼
    function filterKoalas() {
        const input = document.getElementById('searchInput').value.toLowerCase();
        
        const filtered = koalaData.filter(koala => {
            // åå‰ã€å‹•ç‰©åœ’ã€ãƒ¡ãƒ¢ã®å†…å®¹ã§æ¤œç´¢ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
            const searchTarget = (koala.name + koala.zoo + koala.memo).toLowerCase();
            return searchTarget.includes(input);
        });
        
        renderKoalas(filtered);
    }

    // ãƒšãƒ¼ã‚¸ãŒé–‹ã„ãŸã‚‰èª­ã¿è¾¼ã¿é–‹å§‹
    window.addEventListener('load', loadFromSpreadsheet);

</script>

</body>
</html>